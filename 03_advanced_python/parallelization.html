
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parallelization &#8212; Bio-image Analysis Notebooks</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Image analysis basics" href="../12_image_analysis_basics/readme.html" />
    <link rel="prev" title="Workflows in napari" href="napari_workflows.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Bio-image Analysis Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Bio-image Analysis Notebooks
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01_introduction/trailer.html">
   Trailer: Bio-image Analysis with Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_introduction/readme.html">
   Setting up your computer
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02_python_basics/readme.html">
   Python basics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/01_our_first_juptyer_notebook.html">
     Python code in Jupyter notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/02_Math_in_python.html">
     Basic math in python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/03_Dont_try_this_at_home.html">
     Pitfalls when working with Jupyter notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/04_Basic_types.html">
     Basic types in python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/05_lists_tuples.html">
     Lists and tuples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/05a_cropping_lists.html">
     Cropping lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/05b_sorting_lists.html">
     Sorting lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/06_Dictionaries_and_tables.html">
     Dictionaries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/07_Conditions.html">
     Conditions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/08_loops.html">
     Loops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_python_basics/09_custom_functions.html">
     Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="readme.html">
   Advanced python programming
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="custom_libraries.html">
     Custom libraries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="functional_parameters.html">
     Functional parameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="napari_workflows.html">
     Workflows in napari
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Parallelization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../12_image_analysis_basics/readme.html">
   Image analysis basics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../12_image_analysis_basics/01_Introduction_to_image_processing.html">
     Introduction to image processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12_image_analysis_basics/02_Working_with_images.html">
     Working with images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../12_image_analysis_basics/04_multi_channel_image_data.html">
     Multi-channel image data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../15_gpu_acceleration/readme.html">
   GPU accelerated image processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../15_gpu_acceleration/clesperanto.html">
     clEsperanto
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15_gpu_acceleration/why_GPU_acceleration.html">
     Why GPU-acceleration makes sense
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15_gpu_acceleration/cupy.html">
     GPU-accelerated image processing using CUPY and CUCIM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15_gpu_acceleration/memory_management.html">
     Tracing memory consumption
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../15_gpu_acceleration/further_reading.html">
     Further reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../16_3d_image_visualization/readme.html">
   Image visualization in 3D
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../16_3d_image_visualization/10_nd_image_data.html">
     Multidimensional image stacks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16_3d_image_visualization/inspecting_3d_images.html">
     Inspecting 3D image data with pyclesperanto
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../16_3d_image_visualization/05_napari.html">
     Interactive image visualization with napari
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../18_image_filtering/readme.html">
   Image filtering
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../18_image_filtering/01_Filtering.html">
     Filtering images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18_image_filtering/convolution.html">
     Convolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18_image_filtering/02_noise_removal.html">
     Noise removal filters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18_image_filtering/03_background_removal.html">
     Background removal filters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18_image_filtering/edge_detection_and_enhancement.html">
     Edge detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18_image_filtering/simpleitk.html">
     Processing images using SimpleITK
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../18a_deconvolution/readme.html">
   Image deconvolution
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../18a_deconvolution/introduction_deconvolution.html">
     An introduction to image deconvolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18a_deconvolution/extract_psf.html">
     Determining the point-spread-function from a bead image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../18a_deconvolution/richardson_lucy_deconvolution.html">
     Richardson-Lucy-Deconvolution on OpenCL-compatible GPUs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../19_spatial_transforms/readme.html">
   Spatial transforms
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../19_spatial_transforms/coordinate_systems.html">
     Coordinate systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19_spatial_transforms/cropping.html">
     Slicing and cropping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19_spatial_transforms/affine_transforms_scikit_image.html">
     Affine transforms using scikit-image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19_spatial_transforms/affine_transforms_scipy.html">
     Affine transforms using Scipy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19_spatial_transforms/affine_transforms_cupy.html">
     Affine transforms using cupy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../19_spatial_transforms/affine_transforms_clesperanto.html">
     Affine transforms using clesperanto
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../20_image_segmentation/readme.html">
   Image segmentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/06_Introduction_to_image_segmentation.html">
     Image segmentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/07_Thresholding.html">
     Thresholding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/08_binary_mask_refinement.html">
     Binary mask refinement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/split_touching_objects.html">
     Split touching objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/09_connected_component_labeling.html">
     Label images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/10_touching_objects_labeling.html">
     Touching objects labeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/11_voronoi_otsu_labeling.html">
     Voronoi-Otsu-labeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/14_remove_labels_on_image_edges.html">
     Remove labels on image edges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/15_sequential_labeling.html">
     Sequential object (re-)labeling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/segmentation_2d_membranes.html">
     Image Segmentation from membrane images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/nsbatwm.html">
     Segment nuclei and cells (blobs and things with membranes)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../20_image_segmentation/Segmentation_3D.html">
     3D Image Segmentation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../20a_pixel_classification/readme.html">
   Machine learning for image segmentation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../22_feature_extraction/readme.html">
   Feature extraction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../22_feature_extraction/quantitative_measurements.html">
     Quantitative image analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../22_feature_extraction/count_blobs.html">
     Counting bright objects in images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../22_feature_extraction/statistics_with_pyclesperanto.html">
     Basic statistics with pyclesperanto
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../22_feature_extraction/statistics_with_simpleitk.html">
     Statistics using SimpleITK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../22_feature_extraction/comparison_of_measurements_from_different_libraries.html">
     Comparison of measurements from different libraries
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../25_neighborhood_relationships_between_cells/readme.html">
   Neighborhood analysis in tissues
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../25_neighborhood_relationships_between_cells/01_neighborhood_definitions.html">
     Neighborhood definitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25_neighborhood_relationships_between_cells/05_count_touching_neighbors.html">
     Count touching neighbors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25_neighborhood_relationships_between_cells/06_mesh_with_distances.html">
     Draw distance-meshes between neighbors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25_neighborhood_relationships_between_cells/distance_to_other_labels.html">
     Measure the distance to cells in another label image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25_neighborhood_relationships_between_cells/other_proximal_labels_count.html">
     Count proximal labels in an other label image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25_neighborhood_relationships_between_cells/neighbor_meshes_in_3d.html">
     Neighbor meshes in three dimensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../25_neighborhood_relationships_between_cells/label_neighbor_filters.html">
     Label neighbor filters
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../27_cell_classification/readme.html">
   Cell classification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../27_cell_classification/apoc_object_classifier.html">
     Object classification on OpenCL-compatible GPUs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../27_cell_classification/forest_statistics.html">
     Random forest decision making statistics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../28_colocalization/readme.html">
   Colocalization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../28_colocalization/counting_nuclei_multichannel.html">
     Counting nuclei according to expression in multiple channels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../28_colocalization/differentiate_nuclei_intensity.html">
     Differentiating nuclei according to signal intensity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../31_graphical_user_interfaces/readme.html">
   Graphical user interfaces
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../31_graphical_user_interfaces/napari_magicgui.html">
     Interactive parameter tuning with napari and magicgui
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../31_graphical_user_interfaces/napari_dask.html">
     Tribolium embryo morphometry over time in Napari
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../31_graphical_user_interfaces/napari_crop.html">
     Interactive cropping with napari
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../32_tiled_image_processing/readme.html">
   Tiled image processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiled_nuclei_counting_quick.html">
     Tiled image processing, a quick run-through
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiling_images_naive_approach.html">
     Tiling images - the naive approach
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiling_images_with_overlap.html">
     Tiling images with overlap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiled_connected_component_labeling.html">
     Connected component labeling in tiles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiled_object_measurements.html">
     Measurements in objects in tiled images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiled_image_file_formats_zarr.html">
     Tiled image file formats: zarr
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiled_area_mapping.html">
     Map area of objects in tiles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../32_tiled_image_processing/tiled_nuclei_counting.html">
     Counting nuclei in tiles
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../33_batch_processing/readme.html">
   Batch processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../33_batch_processing/12_process_folders.html">
     How process files in a folder
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../40_tabular_data_wrangling/readme.html">
   Tabular data wrangling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../40_tabular_data_wrangling/introduction_dataframes.html">
     Introduction to working with DataFrames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../40_tabular_data_wrangling/explore_dataset.html">
     Exploring tabular data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../40_tabular_data_wrangling/descriptive_statistics.html">
     Basic descriptive statistcs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../40_tabular_data_wrangling/handling_NaNs.html">
     Handling NaN values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../40_tabular_data_wrangling/pivot_tables.html">
     Pivot tables
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../51_plotting/readme.html">
   Plotting
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../51_plotting/plotting_seaborn.html">
     Plotting using seaborn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../51_plotting/plotting_matplotlib.html">
     Plotting with Matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../51_plotting/bland_altman_analysis.html">
     Bland-Altman plots
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../60_data_visualization/readme.html">
   Data visualization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../60_data_visualization/overlay_text_on_image.html">
     Overlay texts on images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../60_data_visualization/parametric_maps.html">
     Parametric maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../60_data_visualization/quantitative_neighbor_maps.html">
     Quantitative maps from neighbor statistics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../imprint.html">
   Imprint
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/03_advanced_python/parallelization.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/haesleinhuepf/BioImageAnalysisNotebooks"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/haesleinhuepf/BioImageAnalysisNotebooks/issues/new?title=Issue%20on%20page%20%2F03_advanced_python/parallelization.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/haesleinhuepf/BioImageAnalysisNotebooks/main?urlpath=tree/docs/03_advanced_python/parallelization.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parallelization-using-joblib-parallel">
   Parallelization using joblib.Parallel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#benchmarking-execution-time">
   Benchmarking execution time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-optimization-using-numba">
   Code optimization using numba
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quality-assurance">
   Quality assurance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#excercise-parallelization">
   Excercise: Parallelization
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Parallelization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parallelization-using-joblib-parallel">
   Parallelization using joblib.Parallel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#benchmarking-execution-time">
   Benchmarking execution time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#code-optimization-using-numba">
   Code optimization using numba
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#quality-assurance">
   Quality assurance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#excercise-parallelization">
   Excercise: Parallelization
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="parallelization">
<h1>Parallelization<a class="headerlink" href="#parallelization" title="Permalink to this headline">¶</a></h1>
<p>When programming custom algorithms in python, it can happen that our code becomes slow because we run a couple of nested for-loops. If the inner loops do not depend on each other, code can be parallelized and sped up. Note, we are parallelizing code on a central processing unit (CPU) not not mix it up with GPU-acceleration that uses graphics processing units (GPUs).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">platform</span>
</pre></div>
</div>
</div>
</div>
<p>We start with an algorithm that does something with an image at given pixel coordinates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">slow_thing</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1"># Silly algorithm for wasting compute time</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">x</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">y</span>
    <span class="n">image</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We now use <a class="reference external" href="https://docs.python.org/3/library/timeit.html">timeit</a> to measure how long the operation takes for processing a single pixel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> slow_thing(image, 4, 5)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.67 ms ± 12.1 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<p>We now define the operation on the whole image</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_image</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">slow_thing</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We measure the time of this function as mentioned above</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> process_image(image)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>372 ms ± 1.21 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
</div>
</div>
<p>This function is quite slow and parallelization may make sense.</p>
<div class="section" id="parallelization-using-joblib-parallel">
<h2>Parallelization using joblib.Parallel<a class="headerlink" href="#parallelization-using-joblib-parallel" title="Permalink to this headline">¶</a></h2>
<p>A simple and straightforward approach for parallelization is using <a class="reference external" href="https://joblib.readthedocs.io/en/latest/generated/joblib.Parallel.html"><code class="docutils literal notranslate"><span class="pre">joblib.Parallel</span></code></a> and <code class="docutils literal notranslate"><span class="pre">joblib.delayed</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span><span class="p">,</span> <span class="n">cpu_count</span>
</pre></div>
</div>
</div>
</div>
<p>Note the reverse writing of the for loops in the following block. The term <code class="docutils literal notranslate"><span class="pre">delayed(slow_thing)(image,</span> <span class="pre">x,</span> <span class="pre">y)</span></code> is technially a function call, that is not executed. Later, when the return value of this call is actually needed, then the actualy execution will happen. See <a class="reference external" href="https://docs.dask.org/en/stable/delayed.html">dask delayed</a> for details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_image_parallel</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">slow_thing</span><span class="p">)(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> 
                        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> process_image_parallel(image)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>59.1 ms ± 1.59 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div>
</div>
</div>
</div>
<p>A speedup of 7 is not bad. The <code class="docutils literal notranslate"><span class="pre">n_jobs=-1</span></code> implies that all compute units / threads are used. We can also print out how many compute cores were used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cpu_count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<p>For documentation purposes, we can also print out on what kind of CPU that algorithm was executed. This string might be more or less informative depending on what operating system / computer we are executing this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">platform</span><span class="o">.</span><span class="n">processor</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;i386&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="benchmarking-execution-time">
<h2>Benchmarking execution time<a class="headerlink" href="#benchmarking-execution-time" title="Permalink to this headline">¶</a></h2>
<p>In image processing, it is very common that execution time of algorithms shows different patterns depending on image size. We will now benchmark the algorithm above and see how it performs on differently sized images.
To bind a function to benchmark to a given image without executing it, we are using the <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial">partial</a> pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">benchmark</span><span class="p">(</span><span class="n">target_function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests a function on a couple of image sizes and returns times taken for processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>

    <span class="n">benchmark_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

        <span class="c1"># make new data</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        
        <span class="c1"># bind target function to given image</span>
        <span class="n">partial_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">target_function</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

        <span class="c1"># measure execution time</span>
        <span class="n">time_in_s</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">partial_function</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">time_in_s</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>

        <span class="c1"># store results</span>
        <span class="n">benchmark_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">size</span><span class="p">,</span> <span class="n">time_in_s</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">benchmark_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Benchmarking normal&quot;</span><span class="p">)</span>
<span class="n">benchmark_data_normal</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">process_image</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Benchmarking parallel&quot;</span><span class="p">)</span>
<span class="n">benchmark_data_parallel</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">process_image_parallel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Benchmarking normal
Size 10
time 3.6755600420000007 s
Size 20
time 14.606198167 s
Size 30
time 32.68187025 s
Size 40
time 58.304140666 s
Benchmarking parallel
Size 10
time 0.6165027079999987 s
Size 20
time 2.0231766670000013 s
Size 30
time 4.416658041999995 s
Size 40
time 7.917167458000009 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">benchmark_data_normal</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">benchmark_data_normal</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">benchmark_data_parallel</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">benchmark_data_parallel</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;parallel&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Image size in pixels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Compute time in s&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Compute time in s&#39;)
</pre></div>
</div>
<img alt="../_images/parallelization_24_1.png" src="../_images/parallelization_24_1.png" />
</div>
</div>
<p>If we see this pattern, we speak of <em>linear</em> relationship between data size and compute time. Computer scientists use the <a class="reference external" href="https://en.wikipedia.org/wiki/Big_O_notation">O notation</a> to describe the <a class="reference external" href="https://en.wikipedia.org/wiki/Computational_complexity">complexity</a> of algorithms. This algorithm has <code class="docutils literal notranslate"><span class="pre">O(n)</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span></code> represents the number of pixels in this case.</p>
<p>Let’s take a look at another algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">silly_sum</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="c1"># Silly algorithm for wasting compute time</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="n">l</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">i</span>
        <span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">/</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark_data_silly_sum</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">silly_sum</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Size 10
time 0.049324583000014854 s
Size 20
time 0.7592800000000182 s
Size 30
time 3.7161972079999828 s
Size 40
time 11.734440750000005 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">benchmark_data_silly_sum</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">benchmark_data_silly_sum</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;normal&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Image size in pixels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Compute time in s&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Compute time in s&#39;)
</pre></div>
</div>
<img alt="../_images/parallelization_28_1.png" src="../_images/parallelization_28_1.png" />
</div>
</div>
<p>This algorithm is stronger dependent on image size, the plot shows approximately <a class="reference external" href="https://en.wikipedia.org/wiki/Time_complexity#Table_of_common_time_complexities">quadratic</a> complexity. That means if the data size douples, the compute time multiplies by four. The algorithms O-notation is <code class="docutils literal notranslate"><span class="pre">O(n^2)</span></code>. We could presume that a similar algorithm applied in 3D has cubic complexity, <code class="docutils literal notranslate"><span class="pre">O(n^3)</span></code>. If such algorithms are bottlenecks in your science, parallelization and GPU-acceleration make a lot of sense.</p>
</div>
<div class="section" id="code-optimization-using-numba">
<h2>Code optimization using numba<a class="headerlink" href="#code-optimization-using-numba" title="Permalink to this headline">¶</a></h2>
<p>In case the code we perform is simple and just uses standard python, numpy etc. function, we can use a just-in-time (JIT) compiler, e.g. provided by <a class="reference external" href="https://numba.pydata.org/">numba</a> to speedup the code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">process_image_compiled</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># Silly algorithm for wasting compute time</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
                    <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">x</span>
                <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">y</span>
            <span class="n">image</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> process_image_compiled(image)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>310 ns ± 0.827 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="quality-assurance">
<h2>Quality assurance<a class="headerlink" href="#quality-assurance" title="Permalink to this headline">¶</a></h2>
<p>Note that in this section we only measured conmpute time of algorithms. We did not determine if the differently optimized versions of the algorithms produce the same result. Quality assurance is good scientific practice. The same is relevant in the context of GPU-acceleration and for example described in detail <a class="reference external" href="https://arxiv.org/pdf/2008.11799">here</a>.</p>
</div>
<div class="section" id="excercise-parallelization">
<h2>Excercise: Parallelization<a class="headerlink" href="#excercise-parallelization" title="Permalink to this headline">¶</a></h2>
<p>To practice parallelization, parallelize the function <code class="docutils literal notranslate"><span class="pre">silly_sum</span></code> shown above and plot its performance in comparison with the non-parallel version.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./03_advanced_python"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="napari_workflows.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Workflows in napari</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../12_image_analysis_basics/readme.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Image analysis basics</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Robert Haase, Miguel Fernandes, Marcelo Leomil Zoccoler & add-your-name-here-by-sending-a-pull-request-containing-a-notebook<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>